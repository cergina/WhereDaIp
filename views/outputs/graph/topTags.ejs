<!DOCTYPE html>
<html lang="en">
<!-- head -->
<%- include('../../_headerGraph') %> 
<body>
    <% var countGraphs = 2 %> 

    <div class="container">
        <!-- alert at top -->
        <div class="alert alert-info">
            <h1 class="mb-4 display-4">Graphs</h1> 
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item"><a href="/presentation/">Results</a></li>
                    <li class="breadcrumb-item"><a href="/graphs">Graphs</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Tags</li>
                </ol>
              </nav>
        </div>
        <!-- info -->
        <div class="bd-callout bd-callout-info">
            <p>
                Here are some graphs showing TOP 5 values, under them there is a full list.
            </p>
        </div>

        <!-- main content -->
        <div class="form-group mb-2">
            <div class="row" style="justify-content: center; align-items: center;">
                <div class="col-md-6">
                    <canvas id="chart0"></canvas>
                </div>
                <div class="col-md-6">
                    <canvas id="chart1"></canvas>
                </div>
            </div>
        </div>

        <!-- change graph type button -->
        <div class="form-group">
            <div class="row center">
                <div class="col-md-6">
                    <button class="btn btn-secondary btn-lg btn-block" onclick="updateConfigByMutatingFirst()">Change 1st graph type</button>
                </div>
                <div class="col-md-6">
                    <button class="btn btn-secondary btn-lg btn-block" onclick="updateConfigByMutatingSecond()">Change 2nd graph type</button>        
                </div>
            </div>
        </div>


        <!-- text can be too small, so table is here as well -->
        <div id="wrapper"></div>

        
        <div class="center">
            <small class="form-text text-muted" id="datetime">Data gotten at [time here].</small>
        </div>
    </div>

    <script>
        let chartCtx0 = document.getElementById('chart0').getContext('2d')
        let chartCtx1 = document.getElementById('chart1').getContext('2d')
        var chart0
        var chart1
        let data0
        let data1
    </script>

    <script>
        fetch("/accessible/topTags.json")
            .then(response => response.json())
            .then(data => {"?"
                chart0 = new Chart(chartCtx0, data)
                data0 = data
            })

        fetch("/accessible/topTags.json")
            .then(response => response.json())
            .then(data => {
                // bar, pie, horizontalBar, line, doughnut, radar, polarArea
                data.type = 'polarArea'
                chart1 = new Chart(chartCtx1, data)
                data1 = data
            })
        
        fetch("/accessible/topTags.json")
            .then(response => response.json())
            .then(data => {
                let time = data.time
                new gridjs.Grid({ 
                    columns: data.forGridJs.tableNames,
                    data: data.forGridJs.tableValues
                }).render(document.getElementById('wrapper'))
                
                document.getElementById('datetime').textContent = `Data calculated at ${time}`
            })
            
    </script>
    
    <script>
        function updateConfigByMutatingFirst() {
            if (data0.type === 'bar')
                data0.type = 'line'
            else if (data0.type === 'line') {
                data0.type = 'bubble'
            } else {
                data0.type = 'bar'
            }

            chart0.destroy()
            chart0 = new Chart(chartCtx0, data0)
        }

        function updateConfigByMutatingSecond() {
            if (data1.type === 'polarArea')
                data1.type = 'pie'
            else if (data1.type === 'pie') {
                data1.type = 'doughnut'
            } else if (data1.type === 'doughnut'){
                data1.type = 'radar'
            } else {
                data1.type = 'polarArea'
            }

            chart1.destroy()
            chart1 = new Chart(chartCtx1, data1)
        }

        
    </script>
  
</body>
</html>


